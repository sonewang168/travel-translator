# ğŸŒ æ—…éŠ~å³æ™‚ç¿»è­¯ - å®Œæ•´æ¶æ§‹è¨­è¨ˆ

## ğŸ“ ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä½¿ç”¨è€…ç«¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   PWA App   â”‚        â”‚  LINE App   â”‚        â”‚  Web ç‰ˆ   â”‚  â”‚
â”‚   â”‚  (æ‰‹æ©Ÿå®‰è£)  â”‚        â”‚  (èŠå¤©æ©Ÿå™¨äºº) â”‚        â”‚ (ç€è¦½å™¨)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                      â”‚                      â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚                      â”‚
           â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Railway é›²ç«¯æœå‹™                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                   Node.js / Express                      â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚  â”‚ éœæ…‹æª”æ¡ˆ   â”‚  â”‚ LINE Bot  â”‚  â”‚   ç¿»è­¯ API è·¯ç”±    â”‚   â”‚  â”‚
â”‚   â”‚  â”‚ (PWA/Web) â”‚  â”‚  Webhook  â”‚  â”‚  /api/translate   â”‚   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    æœå‹™æ•´åˆå±¤                             â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚  â”‚  Google   â”‚  â”‚  DeepL    â”‚  â”‚   OpenAI Whisper  â”‚   â”‚  â”‚
â”‚   â”‚  â”‚ Translate â”‚  â”‚    API    â”‚  â”‚   (èªéŸ³è¾¨è­˜)       â”‚   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    è³‡æ–™å„²å­˜ (å¯é¸)                        â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚   â”‚  â”‚  Redis    â”‚  â”‚  SQLite   â”‚                          â”‚  â”‚
â”‚   â”‚  â”‚  (å¿«å–)   â”‚  â”‚ (æ­·å²è¨˜éŒ„) â”‚                          â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å°ˆæ¡ˆç›®éŒ„çµæ§‹

```
travel-translator/
â”œâ”€â”€ ğŸ“‚ public/                    # å‰ç«¯éœæ…‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html               # PWA ä¸»é é¢ (å«é–‹æ©Ÿå‹•ç•«)
â”‚   â”œâ”€â”€ manifest.json            # PWA è¨­å®š
â”‚   â”œâ”€â”€ sw.js                    # Service Worker
â”‚   â”œâ”€â”€ ğŸ“‚ icons/                # App åœ–ç¤º
â”‚   â”‚   â”œâ”€â”€ icon-192.png
â”‚   â”‚   â””â”€â”€ icon-512.png
â”‚   â”œâ”€â”€ ğŸ“‚ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â””â”€â”€ ğŸ“‚ js/
â”‚       â”œâ”€â”€ app.js               # ä¸»ç¨‹å¼é‚è¼¯
â”‚       â”œâ”€â”€ speech.js            # èªéŸ³è¾¨è­˜/åˆæˆ
â”‚       â””â”€â”€ translate.js         # ç¿»è­¯ API å‘¼å«
â”‚
â”œâ”€â”€ ğŸ“‚ src/                       # å¾Œç«¯ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ index.js                 # Express ä¸»å…¥å£
â”‚   â”œâ”€â”€ ğŸ“‚ routes/
â”‚   â”‚   â”œâ”€â”€ translate.js         # ç¿»è­¯ API
â”‚   â”‚   â””â”€â”€ linebot.js           # LINE Bot Webhook
â”‚   â”œâ”€â”€ ğŸ“‚ services/
â”‚   â”‚   â”œâ”€â”€ translator.js        # ç¿»è­¯æœå‹™æ•´åˆ
â”‚   â”‚   â”œâ”€â”€ speechToText.js      # èªéŸ³è½‰æ–‡å­—
â”‚   â”‚   â””â”€â”€ textToSpeech.js      # æ–‡å­—è½‰èªéŸ³
â”‚   â””â”€â”€ ğŸ“‚ utils/
â”‚       â””â”€â”€ languages.js         # èªè¨€ä»£ç¢¼å°ç…§è¡¨
â”‚
â”œâ”€â”€ .env                         # ç’°å¢ƒè®Šæ•¸ (å‹¿ä¸Šå‚³)
â”œâ”€â”€ .env.example                 # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ package.json
â”œâ”€â”€ railway.json                 # Railway éƒ¨ç½²è¨­å®š
â””â”€â”€ README.md
```

---

## ğŸš‚ Railway éƒ¨ç½²è¨­å®š

### railway.json
```json
{
    "$schema": "https://railway.app/railway.schema.json",
    "build": {
        "builder": "NIXPACKS"
    },
    "deploy": {
        "numReplicas": 1,
        "startCommand": "node src/index.js",
        "healthcheckPath": "/health",
        "healthcheckTimeout": 30,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 3
    }
}
```

### ç’°å¢ƒè®Šæ•¸ (.env)
```env
# ä¼ºæœå™¨è¨­å®š
PORT=3000
NODE_ENV=production

# LINE Bot
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„LINE_Channel_Access_Token
LINE_CHANNEL_SECRET=ä½ çš„LINE_Channel_Secret

# ç¿»è­¯ API (æ“‡ä¸€æˆ–å¤šå€‹)
GOOGLE_TRANSLATE_API_KEY=ä½ çš„Google_API_Key
DEEPL_API_KEY=ä½ çš„DeepL_API_Key

# OpenAI (èªéŸ³è¾¨è­˜)
OPENAI_API_KEY=ä½ çš„OpenAI_API_Key

# å¯é¸ï¼šè³‡æ–™åº«
DATABASE_URL=ä½ çš„è³‡æ–™åº«é€£ç·šå­—ä¸²
REDIS_URL=ä½ çš„Redisé€£ç·šå­—ä¸²
```

---

## ğŸ¤– LINE Bot æ•´åˆè¨­è¨ˆ

### LINE Bot åŠŸèƒ½æµç¨‹

```
ä½¿ç”¨è€…å‚³é€è¨Šæ¯
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LINE Platform  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Webhook POST
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Railway Server                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         /webhook/line                  â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚  1. é©—è­‰ LINE Signature               â”‚  â”‚
â”‚  â”‚  2. è§£æè¨Šæ¯é¡å‹                       â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ æ–‡å­—è¨Šæ¯ â†’ ç›´æ¥ç¿»è­¯            â”‚  â”‚
â”‚  â”‚     â””â”€â”€ èªéŸ³è¨Šæ¯ â†’ STT â†’ ç¿»è­¯          â”‚  â”‚
â”‚  â”‚  3. å‘¼å«ç¿»è­¯ API                       â”‚  â”‚
â”‚  â”‚  4. å›å‚³ç¿»è­¯çµæœ + èªéŸ³                â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LINE Bot æŒ‡ä»¤è¨­è¨ˆ

| æŒ‡ä»¤ | åŠŸèƒ½ | ç¯„ä¾‹ |
|-----|------|------|
| `ç›´æ¥è¼¸å…¥æ–‡å­—` | è‡ªå‹•ç¿»è­¯ (é è¨­ä¸­â†’è‹±) | `ä½ å¥½` â†’ `Hello` |
| `/è¨­å®š èªè¨€A èªè¨€B` | è¨­å®šç¿»è­¯æ–¹å‘ | `/è¨­å®š ä¸­æ–‡ æ—¥æ–‡` |
| `/èªè¨€` | é¡¯ç¤ºæ”¯æ´èªè¨€åˆ—è¡¨ | é¡¯ç¤º 20 ç¨®èªè¨€ |
| `/äº¤æ›` | äº¤æ›ç¿»è­¯æ–¹å‘ | ä¸­â†’æ—¥ è®Šæˆ æ—¥â†’ä¸­ |
| `/èªªæ˜` | ä½¿ç”¨èªªæ˜ | é¡¯ç¤ºæ“ä½œæŒ‡å— |
| `ğŸ¤ èªéŸ³è¨Šæ¯` | èªéŸ³ç¿»è­¯ | è‡ªå‹•è¾¨è­˜ä¸¦ç¿»è­¯ |

---

## ğŸ’» æ ¸å¿ƒç¨‹å¼ç¢¼

### å¾Œç«¯ä¸»ç¨‹å¼ (src/index.js)

```javascript
const express = require('express');
const cors = require('cors');
const path = require('path');
const lineRouter = require('./routes/linebot');
const translateRouter = require('./routes/translate');

const app = express();
const PORT = process.env.PORT || 3000;

// ä¸­ä»‹è»Ÿé«”
app.use(cors());
app.use(express.json({ limit: '10mb' }));
app.use(express.static(path.join(__dirname, '../public')));

// å¥åº·æª¢æŸ¥
app.get('/health', (req, res) => {
    res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// API è·¯ç”±
app.use('/api/translate', translateRouter);
app.use('/webhook/line', lineRouter);

// PWA è·¯ç”± (æ‰€æœ‰å…¶ä»–è«‹æ±‚å°å‘ index.html)
app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../public/index.html'));
});

app.listen(PORT, () => {
    console.log(`ğŸŒ æ—…éŠç¿»è­¯ä¼ºæœå™¨å•Ÿå‹•æ–¼ port ${PORT}`);
});
```

### LINE Bot Webhook (src/routes/linebot.js)

```javascript
const express = require('express');
const crypto = require('crypto');
const { translateText } = require('../services/translator');

const router = express.Router();
const LINE_TOKEN = process.env.LINE_CHANNEL_ACCESS_TOKEN;
const LINE_SECRET = process.env.LINE_CHANNEL_SECRET;

// ä½¿ç”¨è€…è¨­å®šå„²å­˜ (ç”Ÿç”¢ç’°å¢ƒå»ºè­°ç”¨ Redis)
const userSettings = new Map();

// é©—è­‰ LINE Signature
function validateSignature(body, signature) {
    const hash = crypto
        .createHmac('sha256', LINE_SECRET)
        .update(body)
        .digest('base64');
    return hash === signature;
}

// å›è¦†è¨Šæ¯
async function replyMessage(replyToken, messages) {
    const response = await fetch('https://api.line.me/v2/bot/message/reply', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${LINE_TOKEN}`
        },
        body: JSON.stringify({ replyToken, messages })
    });
    return response.json();
}

// Webhook è™•ç†
router.post('/', express.raw({ type: 'application/json' }), async (req, res) => {
    const signature = req.headers['x-line-signature'];
    
    if (!validateSignature(req.body, signature)) {
        return res.status(403).send('Invalid signature');
    }

    const body = JSON.parse(req.body);
    
    for (const event of body.events) {
        if (event.type === 'message') {
            await handleMessage(event);
        }
    }
    
    res.status(200).send('OK');
});

// è™•ç†è¨Šæ¯
async function handleMessage(event) {
    const userId = event.source.userId;
    const replyToken = event.replyToken;
    
    // å–å¾—ä½¿ç”¨è€…è¨­å®šï¼Œé è¨­ä¸­æ–‡â†’è‹±æ–‡
    const settings = userSettings.get(userId) || { from: 'zh-TW', to: 'en' };
    
    if (event.message.type === 'text') {
        const text = event.message.text;
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºæŒ‡ä»¤
        if (text.startsWith('/')) {
            await handleCommand(replyToken, userId, text);
            return;
        }
        
        // ç¿»è­¯æ–‡å­—
        const result = await translateText(text, settings.from, settings.to);
        
        await replyMessage(replyToken, [
            { type: 'text', text: `ğŸŒ ${result.translated}` },
            { type: 'text', text: `ğŸ—£ï¸ åŸæ–‡: ${text}` }
        ]);
    }
    
    if (event.message.type === 'audio') {
        // è™•ç†èªéŸ³è¨Šæ¯
        await replyMessage(replyToken, [
            { type: 'text', text: 'ğŸ¤ èªéŸ³ç¿»è­¯åŠŸèƒ½é–‹ç™¼ä¸­...' }
        ]);
    }
}

// è™•ç†æŒ‡ä»¤
async function handleCommand(replyToken, userId, text) {
    const parts = text.split(' ');
    const command = parts[0].toLowerCase();
    
    switch (command) {
        case '/èªè¨€':
            await replyMessage(replyToken, [{
                type: 'text',
                text: `ğŸŒ æ”¯æ´èªè¨€åˆ—è¡¨ï¼š
                
ğŸ‡¹ğŸ‡¼ ä¸­æ–‡(ç¹) | ğŸ‡¨ğŸ‡³ ä¸­æ–‡(ç°¡) | ğŸ‡ºğŸ‡¸ è‹±æ–‡
ğŸ‡¯ğŸ‡µ æ—¥æ–‡ | ğŸ‡°ğŸ‡· éŸ“æ–‡ | ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™æ–‡
ğŸ‡«ğŸ‡· æ³•æ–‡ | ğŸ‡©ğŸ‡ª å¾·æ–‡ | ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ©æ–‡
ğŸ‡µğŸ‡¹ è‘¡è„ç‰™æ–‡ | ğŸ‡·ğŸ‡º ä¿„æ–‡ | ğŸ‡³ğŸ‡± è·è˜­æ–‡
ğŸ‡¹ğŸ‡­ æ³°æ–‡ | ğŸ‡»ğŸ‡³ è¶Šå—æ–‡ | ğŸ‡®ğŸ‡© å°å°¼æ–‡
ğŸ‡®ğŸ‡³ å°åœ°æ–‡ | ğŸ‡¸ğŸ‡¦ é˜¿æ‹‰ä¼¯æ–‡ | ğŸ‡®ğŸ‡± å¸Œä¼¯ä¾†æ–‡
ğŸ‡¹ğŸ‡· åœŸè€³å…¶æ–‡ | ğŸ‡µğŸ‡± æ³¢è˜­æ–‡`
            }]);
            break;
            
        case '/è¨­å®š':
            // ç°¡åŒ–è¨­å®šé‚è¼¯
            await replyMessage(replyToken, [{
                type: 'text',
                text: 'âœ… ç¿»è­¯æ–¹å‘å·²æ›´æ–°ï¼'
            }]);
            break;
            
        case '/äº¤æ›':
            const settings = userSettings.get(userId) || { from: 'zh-TW', to: 'en' };
            userSettings.set(userId, { from: settings.to, to: settings.from });
            await replyMessage(replyToken, [{
                type: 'text',
                text: `ğŸ”„ ç¿»è­¯æ–¹å‘å·²äº¤æ›ï¼`
            }]);
            break;
            
        default:
            await replyMessage(replyToken, [{
                type: 'text',
                text: `ğŸ“– ä½¿ç”¨èªªæ˜ï¼š
                
ç›´æ¥è¼¸å…¥æ–‡å­—å³å¯ç¿»è­¯ï¼

æŒ‡ä»¤åˆ—è¡¨ï¼š
/èªè¨€ - æŸ¥çœ‹æ”¯æ´èªè¨€
/è¨­å®š ä¸­æ–‡ è‹±æ–‡ - è¨­å®šç¿»è­¯æ–¹å‘
/äº¤æ› - äº¤æ›ç¿»è­¯æ–¹å‘
/èªªæ˜ - é¡¯ç¤ºæ­¤èªªæ˜

ğŸ¤ ä¹Ÿå¯ä»¥ç›´æ¥å‚³é€èªéŸ³è¨Šæ¯ï¼`
            }]);
    }
}

module.exports = router;
```

### ç¿»è­¯æœå‹™ (src/services/translator.js)

```javascript
const GOOGLE_API_KEY = process.env.GOOGLE_TRANSLATE_API_KEY;
const DEEPL_API_KEY = process.env.DEEPL_API_KEY;

// èªè¨€ä»£ç¢¼å°ç…§è¡¨
const langCodes = {
    'zh-TW': { google: 'zh-TW', deepl: 'ZH' },
    'zh-CN': { google: 'zh-CN', deepl: 'ZH' },
    'en': { google: 'en', deepl: 'EN' },
    'ja': { google: 'ja', deepl: 'JA' },
    'ko': { google: 'ko', deepl: 'KO' },
    'es': { google: 'es', deepl: 'ES' },
    'fr': { google: 'fr', deepl: 'FR' },
    'de': { google: 'de', deepl: 'DE' },
    // ... å…¶ä»–èªè¨€
};

// Google ç¿»è­¯
async function googleTranslate(text, from, to) {
    const url = `https://translation.googleapis.com/language/translate/v2`;
    
    const response = await fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            q: text,
            source: from,
            target: to,
            key: GOOGLE_API_KEY
        })
    });
    
    const data = await response.json();
    return data.data.translations[0].translatedText;
}

// DeepL ç¿»è­¯ (æ­æ´²èªç³»æ›´æº–)
async function deeplTranslate(text, from, to) {
    const response = await fetch('https://api-free.deepl.com/v2/translate', {
        method: 'POST',
        headers: {
            'Authorization': `DeepL-Auth-Key ${DEEPL_API_KEY}`,
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            text: [text],
            source_lang: langCodes[from]?.deepl,
            target_lang: langCodes[to]?.deepl
        })
    });
    
    const data = await response.json();
    return data.translations[0].text;
}

// ä¸»ç¿»è­¯å‡½æ•¸ (è‡ªå‹•é¸æ“‡æœ€ä½³ API)
async function translateText(text, from, to) {
    try {
        // æ­æ´²èªç³»å„ªå…ˆç”¨ DeepL
        const europeanLangs = ['en', 'fr', 'de', 'es', 'it', 'pt', 'nl', 'pl', 'ru'];
        
        if (DEEPL_API_KEY && europeanLangs.includes(to)) {
            const translated = await deeplTranslate(text, from, to);
            return { translated, engine: 'deepl' };
        }
        
        // å…¶ä»–ç”¨ Google
        const translated = await googleTranslate(text, from, to);
        return { translated, engine: 'google' };
        
    } catch (error) {
        console.error('ç¿»è­¯éŒ¯èª¤:', error);
        throw error;
    }
}

module.exports = { translateText, googleTranslate, deeplTranslate };
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. Railway éƒ¨ç½²

```bash
# 1. å®‰è£ Railway CLI
npm install -g @railway/cli

# 2. ç™»å…¥
railway login

# 3. åˆå§‹åŒ–å°ˆæ¡ˆ
railway init

# 4. è¨­å®šç’°å¢ƒè®Šæ•¸
railway variables set LINE_CHANNEL_ACCESS_TOKEN=xxx
railway variables set LINE_CHANNEL_SECRET=xxx
railway variables set GOOGLE_TRANSLATE_API_KEY=xxx

# 5. éƒ¨ç½²
railway up

# 6. å–å¾—ç¶²å€
railway domain
```

### 2. LINE Bot è¨­å®š

1. å‰å¾€ [LINE Developers Console](https://developers.line.biz/)
2. å»ºç«‹ Provider å’Œ Messaging API Channel
3. å–å¾— **Channel Access Token** å’Œ **Channel Secret**
4. è¨­å®š **Webhook URL**: `https://ä½ çš„railwayç¶²å€/webhook/line`
5. é–‹å•Ÿ **Use webhook**
6. é—œé–‰ **Auto-reply messages**

### 3. LINE å®˜æ–¹å¸³è™Ÿè¨­å®š

1. å‰å¾€ [LINE Official Account Manager](https://manager.line.biz/)
2. è¨­å®šå•å€™èªã€è‡ªå‹•å›æ‡‰
3. åŠ å…¥å¥½å‹ QR Code

---

## ğŸ“± PWA å®‰è£æŒ‡å—

### iOS (Safari)
1. é–‹å•Ÿç¶²ç«™
2. é»æ“Šã€Œåˆ†äº«ã€æŒ‰éˆ•
3. é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€

### Android (Chrome)
1. é–‹å•Ÿç¶²ç«™
2. é»æ“Šã€Œæ›´å¤šé¸é …ã€(â‹®)
3. é¸æ“‡ã€Œæ–°å¢è‡³ä¸»ç•«é¢ã€

---

## ğŸ¯ åŠŸèƒ½å„ªå…ˆç´š

### Phase 1 (MVP)
- [x] é–‹æ©Ÿå‹•ç•«
- [x] åŸºæœ¬ UI æ¡†æ¶
- [ ] æ–‡å­—ç¿»è­¯ API
- [ ] LINE Bot æ–‡å­—ç¿»è­¯
- [ ] Railway éƒ¨ç½²

### Phase 2
- [ ] Web Speech API èªéŸ³è¾¨è­˜
- [ ] TTS èªéŸ³æ’­æ”¾
- [ ] ç¿»è­¯æ­·å²è¨˜éŒ„
- [ ] LINE Bot èªéŸ³è¨Šæ¯

### Phase 3
- [ ] é›¢ç·šç¿»è­¯å¿«å–
- [ ] å¸¸ç”¨ç‰‡èªåº«
- [ ] å¤šäººå°è©±æ¨¡å¼
- [ ] åœ–ç‰‡ OCR ç¿»è­¯

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. Railway æ—¥èªŒ: `railway logs`
2. LINE Bot Webhook ç‹€æ…‹
3. API Key æ˜¯å¦æ­£ç¢ºè¨­å®š
